<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>ç¶²é ç‰ˆæƒé›·éŠæˆ²</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            background-color: #f0f0f0;
            margin: 0;
            padding: 20px;
        }

        h1 {
            margin-bottom: 20px;
        }

        .game-container {
            background-color: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            max-width: 800px;
            width: 100%;
        }

        .game-controls {
            margin: 20px 0;
            display: flex;
            gap: 20px;
            align-items: center;
            flex-wrap: wrap;
        }

        .grid {
            display: grid;
            gap: 2px;
            background-color: #999;
            padding: 5px;
            border-radius: 5px;
            margin: 20px auto;
        }

        .cell {
            width: 30px;
            height: 30px;
            background-color: #ccc;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            font-weight: bold;
            border: 2px outset #ddd;
        }

        .revealed {
            background-color: #bbb;
            border-style: inset;
        }

        .mine {
            background-color: #ff4444 !important;
        }

        .flag {
            background-color: #44ff44;
        }

        .item-button {
            padding: 8px;
            margin: 5px;
            cursor: pointer;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
        }

        .disabled {
            background-color: #cccccc !important;
            cursor: not-allowed;
        }

        .instructions {
            margin-top: 20px;
            background-color: #f9f9f9;
            padding: 15px;
            border-radius: 5px;
            border: 1px solid #ddd;
        }

        .instructions h2 {
            margin-top: 0;
        }

        .instructions ul {
            padding-left: 20px;
        }
    </style>
</head>
<body>
    <h1>ç¶²é ç‰ˆæƒé›·éŠæˆ²</h1>
    <div class="game-container">
        <div class="game-controls">
            <select id="difficulty">
                <option value="8,10">åˆç´š (8x8)</option>
                <option value="10,15" selected>ä¸­ç´š (10x10)</option>
                <option value="16,40">é«˜ç´š (16x16)</option>
            </select>
            <button id="restart">é‡æ–°é–‹å§‹</button>
            <div>
                <button class="item-button" id="detector">é‡‘å±¬æ¢æ¸¬å™¨ (3)</button>
                <button class="item-button" id="xray">Xå…‰é€è¦– (3)</button>
            </div>
            <div>
                å‰©é¤˜åœ°é›·: <span id="mines-counter">15</span><br>
                æ™‚é–“: <span id="timer">0</span>ç§’
            </div>
        </div>
        <div id="grid" class="grid"></div>
        <div class="instructions">
            <h2>éŠæˆ²èªªæ˜æ›¸</h2>
            <ul>
                <li><strong>éŠæˆ²ç›®æ¨™</strong>ï¼šåœ¨ä¸è§¸ç™¼åœ°é›·çš„æƒ…æ³ä¸‹ï¼Œç¿»é–‹æ‰€æœ‰éåœ°é›·çš„æ ¼å­ã€‚</li>
                <li><strong>æ“ä½œæ–¹å¼</strong>ï¼š
                    <ul>
                        <li><strong>å·¦éµé»æ“Š</strong>ï¼šç¿»é–‹æ ¼å­ã€‚</li>
                        <li><strong>å³éµé»æ“Š</strong>ï¼šæ¨™è¨˜æˆ–å–æ¶ˆæ¨™è¨˜åœ°é›·ï¼ˆé¡¯ç¤ºğŸš©ï¼‰ã€‚</li>
                    </ul>
                </li>
                <li><strong>é“å…·ä½¿ç”¨</strong>ï¼š
                    <ul>
                        <li><strong>é‡‘å±¬æ¢æ¸¬å™¨</strong>ï¼šé»æ“Šé“å…·æŒ‰éˆ•å¾Œï¼Œå†é»æ“Šæ ¼å­ï¼Œé¡¯ç¤ºè©²æ ¼å­3x3ç¯„åœå…§çš„åœ°é›·æ•¸é‡ï¼ˆ2ç§’ï¼‰ã€‚</li>
                        <li><strong>Xå…‰é€è¦–</strong>ï¼šé»æ“Šé“å…·æŒ‰éˆ•å¾Œï¼Œå†é»æ“Šæ ¼å­ï¼Œé¡¯ç¤ºè©²æ ¼å­3x3ç¯„åœå…§çš„åœ°é›·ä½ç½®ï¼ˆ2ç§’ï¼‰ã€‚</li>
                    </ul>
                </li>
                <li><strong>é›£åº¦é¸æ“‡</strong>ï¼šå¯é¸æ“‡åˆç´šã€ä¸­ç´šæˆ–é«˜ç´šé›£åº¦ï¼Œåœ°é›·æ•¸é‡å’Œé›·å€å¤§å°æœƒéš¨ä¹‹è®ŠåŒ–ã€‚</li>
                <li><strong>å‹åˆ©æ¢ä»¶</strong>ï¼šç¿»é–‹æ‰€æœ‰éåœ°é›·çš„æ ¼å­å³ç²å‹ã€‚</li>
                <li><strong>å¤±æ•—æ¢ä»¶</strong>ï¼šç¿»é–‹åœ°é›·æ ¼å­å³å¤±æ•—ã€‚</li>
            </ul>
        </div>
    </div>

    <script>
        class Minesweeper {
            constructor(size, mines) {
                this.size = size;
                this.mines = mines;
                this.grid = [];
                this.revealed = [];
                this.flags = [];
                this.gameOver = false;
                this.startTime = Date.now();
                this.initGrid();
            }

            initGrid() {
                // åˆå§‹åŒ–ç¶²æ ¼
                for(let i = 0; i < this.size; i++) {
                    this.grid[i] = new Array(this.size).fill(0);
                    this.revealed[i] = new Array(this.size).fill(false);
                    this.flags[i] = new Array(this.size).fill(false);
                }

                // æ”¾ç½®åœ°é›·
                let placed = 0;
                while(placed < this.mines) {
                    const x = Math.floor(Math.random() * this.size);
                    const y = Math.floor(Math.random() * this.size);
                    if(this.grid[x][y] !== -1) {
                        this.grid[x][y] = -1;
                        placed++;
                    }
                }

                // è¨ˆç®—æ•¸å­—
                for(let x = 0; x < this.size; x++) {
                    for(let y = 0; y < this.size; y++) {
                        if(this.grid[x][y] === -1) continue;
                        let count = 0;
                        for(let dx = -1; dx <= 1; dx++) {
                            for(let dy = -1; dy <= 1; dy++) {
                                const nx = x + dx;
                                const ny = y + dy;
                                if(nx >= 0 && nx < this.size && ny >= 0 && ny < this.size) {
                                    if(this.grid[nx][ny] === -1) count++;
                                }
                            }
                        }
                        this.grid[x][y] = count;
                    }
                }
            }

            reveal(x, y) {
                if(this.gameOver || this.flags[x][y]) return;
                
                this.revealed[x][y] = true;
                if(this.grid[x][y] === 0) {
                    // è‡ªå‹•å±•é–‹ç©ºç™½å€åŸŸ
                    for(let dx = -1; dx <= 1; dx++) {
                        for(let dy = -1; dy <= 1; dy++) {
                            const nx = x + dx;
                            const ny = y + dy;
                            if(nx >= 0 && nx < this.size && 
                               ny >= 0 && ny < this.size &&
                               !this.revealed[nx][ny]) {
                                this.reveal(nx, ny);
                            }
                        }
                    }
                }
            }

            toggleFlag(x, y) {
                if(!this.revealed[x][y]) {
                    this.flags[x][y] = !this.flags[x][y];
                }
            }

            checkWin() {
                return this.grid.every((row, x) => 
                    row.every((cell, y) => 
                        this.revealed[x][y] || (cell === -1)
                    )
                );
            }
        }

        class GameUI {
            constructor() {
                this.size = 10;
                this.mines = 15;
                this.items = {
                    detector: 3,
                    xray: 3
                };
                this.activeItem = null;
                this.timerInterval = null;
                this.initEventListeners();
                this.newGame();
            }

            newGame() {
                const [size, mines] = document.getElementById('difficulty').value.split(',').map(Number);
                this.size = size;
                this.mines = mines;
                
                if(this.timerInterval) clearInterval(this.timerInterval);
                this.game = new Minesweeper(size, mines);
                this.items = { detector: 3, xray: 3 };
                this.activeItem = null;
                this.updateItemButtons();
                this.renderGrid();
                this.startTimer();
            }

            startTimer() {
                document.getElementById('timer').textContent = '0';
                this.timerInterval = setInterval(() => {
                    const seconds = Math.floor((Date.now() - this.game.startTime) / 1000);
                    document.getElementById('timer').textContent = seconds;
                }, 1000);
            }

            renderGrid() {
                const grid = document.getElementById('grid');
                grid.style.gridTemplateColumns = `repeat(${this.size}, 30px)`;
                grid.innerHTML = '';
                
                for(let x = 0; x < this.size; x++) {
                    for(let y = 0; y < this.size; y++) {
                        const cell = document.createElement('div');
                        cell.className = 'cell';
                        cell.dataset.x = x;
                        cell.dataset.y = y;
                        cell.addEventListener('click', (e) => this.handleClick(x, y, e));
                        cell.addEventListener('contextmenu', (e) => {
                            e.preventDefault();
                            this.handleRightClick(x, y);
                        });
                        grid.appendChild(cell);
                    }
                }
                this.updateView();
            }

            updateView() {
                document.querySelectorAll('.cell').forEach(cell => {
                    const x = parseInt(cell.dataset.x);
                    const y = parseInt(cell.dataset.y);
                    
                    if(this.game.revealed[x][y]) {
                        cell.classList.add('revealed');
                        cell.textContent = this.game.grid[x][y] === 0 ? '' : this.game.grid[x][y];
                        if(this.game.grid[x][y] === -1) cell.classList.add('mine');
                    } else if(this.game.flags[x][y]) {
                        cell.textContent = 'ğŸš©';
                        cell.classList.add('flag');
                    } else {
                        cell.textContent = '';
                        cell.className = 'cell';
                    }
                });
                
                document.getElementById('mines-counter').textContent = 
                    this.mines - this.game.flags.flat().filter(Boolean).length;
            }

            handleClick(x, y, event) {
                if(this.game.gameOver) return;
                
                if(this.activeItem) {
                    this.useItem(x, y);
                    return;
                }

                this.game.reveal(x, y);
                if(this.game.grid[x][y] === -1) {
                    this.gameOver();
                } else if(this.game.checkWin()) {
                    this.victory();
                }
                this.updateView();
            }

            handleRightClick(x, y) {
                if(!this.game.revealed[x][y]) {
                    this.game.toggleFlag(x, y);
                    this.updateView();
                }
            }

            useItem(x, y) {
                if(this.activeItem === 'detector') {
                    this.showDetectorArea(x, y);
                    this.items.detector--;
                } else if(this.activeItem === 'xray') {
                    this.showXRay(x, y);
                    this.items.xray--;
                }
                this.activeItem = null;
                this.updateItemButtons();
            }

            showDetectorArea(x, y) {
                // é¡¯ç¤º3x3ç¯„åœåœ°é›·æ•¸é‡
                for(let dx = -1; dx <= 1; dx++) {
                    for(let dy = -1; dy <= 1; dy++) {
                        const nx = x + dx;
                        const ny = y + dy;
                        if(nx >= 0 && nx < this.size && ny >= 0 && ny < this.size) {
                            const cell = document.querySelector(`[data-x="${nx}"][data-y="${ny}"]`);
                            cell.textContent = this.game.grid[nx][ny];
                            setTimeout(() => {
                                if(!this.game.revealed[nx][ny] && !this.game.flags[nx][ny]) {
                                    cell.textContent = '';
                                }
                            }, 2000);
                        }
                    }
                }
            }

            showXRay(x, y) {
                // é¡¯ç¤º3x3ç¯„åœåœ°é›·ä½ç½®
                for(let dx = -1; dx <= 1; dx++) {
                    for(let dy = -1; dy <= 1; dy++) {
                        const nx = x + dx;
                        const ny = y + dy;
                        if(nx >= 0 && nx < this.size && ny >= 0 && ny < this.size) {
                            if(this.game.grid[nx][ny] === -1) {
                                const cell = document.querySelector(`[data-x="${nx}"][data-y="${ny}"]`);
                                cell.textContent = 'ğŸ’£';
                                setTimeout(() => {
                                    if(!this.game.revealed[nx][ny] && !this.game.flags[nx][ny]) {
                                        cell.textContent = '';
                                    }
                                }, 2000);
                            }
                        }
                    }
                }
            }

            updateItemButtons() {
                document.getElementById('detector').textContent = 
                    `é‡‘å±¬æ¢æ¸¬å™¨ (${this.items.detector})`;
                document.getElementById('xray').textContent = 
                    `Xå…‰é€è¦– (${this.items.xray})`;
                
                document.querySelectorAll('.item-button').forEach(btn => {
                    btn.disabled = this.items[btn.id] <= 0;
                });
            }

            gameOver() {
                this.game.gameOver = true;
                clearInterval(this.timerInterval);
                alert('éŠæˆ²çµæŸï¼ä½ è¸©åˆ°åœ°é›·äº†ï¼');
            }

            victory() {
                this.game.gameOver = true;
                clearInterval(this.timerInterval);
                alert('æ­å–œç²å‹ï¼ğŸ‰ ç£…åŒ…ç¥ä½ æ–°å¹´å¿«æ¨‚ï¼ğŸ†');
            }

            initEventListeners() {
                document.getElementById('restart').addEventListener('click', () => this.newGame());
                document.getElementById('detector').addEventListener('click', () => {
                    if(this.items.detector > 0) {
                        this.activeItem = 'detector';
                        alert('è«‹é»æ“Šè¦åµæ¸¬çš„å€åŸŸ');
                    }
                });
                document.getElementById('xray').addEventListener('click', () => {
                    if(this.items.xray > 0) {
                        this.activeItem = 'xray';
                        alert('è«‹é»æ“Šè¦é€è¦–çš„å€åŸŸ');
                    }
                });
                document.getElementById('difficulty').addEventListener('change', () => this.newGame());
            }
        }

        // å•Ÿå‹•éŠæˆ²
        new GameUI();
    </script>
</body>
</html>